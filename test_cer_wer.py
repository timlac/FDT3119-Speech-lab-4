import numpy as np

decoded_preds = [
    ["t", "h", "e", "_", "h", "o", "_", "t", "h", "e", "w", "i", "t", "_", "b", "e", "_", "s", "t", "o", "p", "e", "r",
     "_", "d", "a", "n", "r", "_", "t", "e", "r", "n", "d", "a", "s", "_", "o", "n", "_", "c", "a", "r", "s", "a", "n",
     "d", "d", "_", "b", "r", "o", "w", "a", "s", "t", "_", "p", "e", "t", "a", "_", "o", "s", "_", "a", "n", "d", "_",
     "f", "e", "t", "_", "b", "u", "t", "e", "n", "_", "p", "e", "s", "i", "s", "_", "t", "o", "_", "b", "e", "t", "l",
     "a", "d", "l", "o", "_", "d", "o", "t", "o", "n", "_", "t", "_", "f", "i", "c", "_", "p", "a", "p", "e", "r", "d",
     "_", "f", "o", "r", "_", "f", "a", "t", "p", "i", "n", "_", "s", "u", "s"],
    ["s", "t", "o", "f", "e", "t", "_", "i", "n", "t", "o", "_", "o", "_", "h", "i", "s", "_", "b", "e", "l", "y", "_",
     "c", "o", "s", "o", "_", "i", "n", "m"],
    ["a", "f", "_", "t", "e", "r", "_", "v", "e", "r", "n", "y", "g", "_", "n", "y", "_", "f", "o", "_", "t", "e", "_",
     "o", "n", "l", "a", "_", "l", "a", "n", "s", "_", "w", "a", "t", "_", "l", "i", "_", "h", "o", "f", "_", "h", "r",
     "_", "a", "n", "_", "b", "a", "r", "n", "_", "h", "e", "s", "_", "q", "l", "o", "l", "i", "d", "_", "q", "o", "r",
     "t", "e", "r", "_", "o", "f", "_", "t", "h", "e", "_", "b", "r", "o", "f", "o", "s"],
    ["o", "a", "_", "b", "a", "r", "t", "i", "_", "a", "n", "d", "_", "e", "_", "g", "r", "o", "d", "_", "i", "n", "d",
     "_", "h", "e", "m", "i", "d"],
    ["n", "o", "_", "b", "e", "_", "d", "a", "n", "_", "f", "r", "e", "s", "s", "i", "n", "_", "n", "o", "l", "y", "_",
     "a", "s", "_", "w", "a", "i", "n", "g", "_", "o", "n", "_", "n", "o", "_", "c", "u", "d", "_", "n", "i", "t", "_",
     "h", "a", "s", "_", "p", "e", "n", "d"],
    ["t", "h", "a", "_", "n", "a", "s", "_", "i", "c", "_", "c", "a", "n", "_", "b", "e", "r", "e", "r", "_", "a", "n",
     "d", "_", "h", "e", "_", "r", "a", "_", "c", "a", "_", "t", "h", "e", "_", "w", "a", "r", "d", "s", "_", "b", "a",
     "_", "w", "e", "r", "d", "s", "_", "o", "_", "s", "h", "o", "l", "i", "s", "_", "f", "r", "i", "t", "_", "m", "e",
     "t", "_", "t", "o", "p", "o", "m", "_", "t", "h", "e", "_", "m", "o", "n", "_", "w", "o", "n", "d", "e", "r", "i",
     "n", "g", "_", "c", "o", "m", "p", "e", "n", "y", "i", "m", "e", "s", "_", "p", "a", "o", "f", "o", "_", "r", "e",
     "r", "i", "n", "e", "s"],
    ["t", "h", "e", "t", "_", "d", "o", "_", "l", "i", "_", "_", "f", "o", "_", "m", "o", "_", "b", "a", "n", "t", "y",
     "_", "a", "_", "p", "o", "n", "_", "t", "h", "e", "_", "p", "a", "t", "_", "w", "r", "_", "o", "n", "_", "a", "_",
     "m", "o", "t", "e", "r", "y", "_", "c", "l", "a", "t", "i", "o", "n", "_", "t", "h", "e", "_", "g", "a", "n", "d",
     "_", "w", "o", "n", "_", "f", "o", "_", "t", "a", "t", "_", "s", "o", "_", "s", "l", "o", "l", "y", "_", "a", "n",
     "d", "_", "t", "o", "s", "p", "r", "a", "t", "_", "a", "_", "b", "r", "o", "_", "i", "c", "s", "_", "w", "l", "i",
     "_", "i", "n", "_", "t", "a"],
    ["t", "e", "_", "c", "o", "d", "_", "e", "_", "l", "e", "_", "s", "i", "i", "n", "_", "d", "i", "f", "r", "e", "n",
     "s", "_", "e", "_", "r", "a", "n", "d", "i", "n", "d", "_", "h", "a", "s", "_", "s", "o"],
    ["t", "h", "e", "_", "c", "a", "o", "s", "_", "o", "n", "_", "w", "i", "c", "h", "i", "s", "_", "a", "r", "d", "h",
     "e", "r", "_", "e", "x", "t", "i", "n", "r", "s", "_", "t", "a", "t", "_", "s", "o", "_", "w", "a", "s", "_", "o",
     "c", "p", "o", "d", "_", "i", "n", "_", "d", "i", "f", "f", "r", "e", "r", "_", "n", "o", "l", "i", "c", "h", "g",
     "o", "_", "i", "n", "_", "s", "o"],
    ["a", "_", "m", "o", "s", "t", "_", "b", "i", "_", "a", "n", "d", "_", "a", "m", "s", "_", "g", "i", "v", "i", "n",
     "_", "t", "o", "_", "w", "o", "_", "b", "a", "g", "e", "r", "r", "f", "_", "w", "i", "s", "_", "r", "l", "u", "s",
     "i", "n", "_", "h", "e", "_", "f", "t", "_", "f", "o", "m", "_", "h", "e", "_", "b", "i", "t", "_", "h", "o", "t",
     "_", "r", "e", "r", "l", "y", "_", "t", "o", "_", "r", "a", "n", "_", "f", "e", "r", "_", "i", "n", "_", "s", "o",
     "_", "s", "o", "m", "_", "b", "e", "s", "e", "r", "_", "o", "f", "_", "a", "c", "t", "o", "_", "w", "l", "o", "_",
     "g", "r", "a", "c", "s"],
    ["b", "o", "n", "o", "_", "e", "n", "i", "s", "_", "i", "d", "e", "_", "c", "r", "a", "r", "_", "o", "_", "h", "a",
     "v", "e", "_", "h", "a", "d", "_", "a", "n", "_", "s", "o", "_", "h", "a", "s", "_", "m", "y", "_", "s", "t", "e",
     "c"],
    ["o", "n", "_", "s", "e", "a", "t", "e", "r", "d", "_", "i", "n", "_", "m", "o", "r", "i", "n", "s", "_", "w", "o",
     "n", "_", "t", "h", "e", "_", "s", "o", "d", "o", "l", "a", "t", "t", "y", "_", "m", "a", "t", "_", "t", "i", "n",
     "_", "t", "h", "e", "_", "c", "h", "a", "p", "p", "l", "o", "_", "t", "o", "_", "r", "e", "_", "s", "i", "e", "_",
     "t", "h", "a", "_", "w", "i", "_", "o", "o", "f", "i", "s", "_", "h", "i", "s", "_", "p", "l", "a", "c", "s", "_",
     "w", "a", "s", "_", "a", "_", "c", "u", "s", "i", "o", "n", "d", "a", "_", "m", "a", "l", "i", "n", "g", "_", "d",
     "a", "s", "_", "c", "o", "t", "t", "h", "e", "r", "_", "r", "l", "i", "s", "_", "o", "_", "b", "e", "_", "a", "t",
     "e", "r", "_", "f", "o", "_", "w", "i", "c", "h", "_", "h", "e", "d", "_", "l", "a", "t", "_", "h", "i", "s", "_",
     "w", "i", "n", "_", "o", "_", "b", "o", "s", "_", "t", "o", "_", "t", "h", "e", "r", "_", "a", "s", "p", "o", "n",
     "s", "e", "s"],
    ["h", "e", "r", "_", "i", "_", "s", "e", "n", "_", "t", "o", "_", "r", "e", "_", "g", "o", "d", "_", "h", "i", "n",
     "_", "w", "a", "t", "h", "_", "m", "i", "_", "p", "i", "t", "y", "_", "f", "e", "r", "_", "h", "o", "l", "i", "n",
     "e", "s", "_", "a", "s", "_", "t", "r", "a", "n", "s", "_", "l", "i", "t", "_", "g", "l", "o", "y", "n", "_", "f",
     "a", "n", "c", "y", "_", "p", "o", "n", "_", "e", "r", "_", "f", "r", "a", "o", "_", "f", "l", "e", "s", "h", "_",
     "t", "a", "_", "n", "o", "t", "_", "h", "e", "_", "m", "o", "y", "_", "a", "n", "_", "t", "o", "_", "s", "i", "n",
     "e", "r", "_", "o", "p", "o", "h", "t", "e", "r"],
    ["i", "t", "_", "h", "a", "v", "e", "r", "_", "h", "e", "_", "w", "a", "s", "_", "a", "n", "_", "p", "o", "d", "_",
     "t", "o", "_", "c", "a", "s", "_", "s", "i", "n", "_", "f", "o", "m", "_", "i", "n", "_", "b", "e", "n", "t", "o",
     "_", "r", "a", "t", "_", "p", "e", "n", "t", "_", "t", "h", "e", "_", "a", "n", "p", "o", "s", "_", "t", "a", "t",
     "_", "m", "o", "_", "a", "m", "_", "w", "a", "s", "_", "t", "h", "e", "_", "w", "i", "s", "h", "_", "t", "o", "f",
     "_", "b", "e", "_", "h", "e", "r", "d", "_", "n", "i", "t"],
    ["h", "e", "_", "c", "i", "t", "_", "t", "o", "_", "f", "a", "n", "_", "h", "o", "_", "c", "o", "_", "b", "e"]]
decoded_targets = [
    ["h", "e", "_", "h", "o", "p", "e", "d", "_", "t", "h", "e", "r", "e", "_", "w", "o", "u", "l", "d", "_", "b", "e",
     "_", "s", "t", "e", "w", "_", "f", "o", "r", "_", "d", "i", "n", "n", "e", "r", "_", "t", "u", "r", "n", "i", "p",
     "s", "_", "a", "n", "d", "_", "c", "a", "r", "r", "o", "t", "s", "_", "a", "n", "d", "_", "b", "r", "u", "i", "s",
     "e", "d", "_", "p", "o", "t", "a", "t", "o", "e", "s", "_", "a", "n", "d", "_", "f", "a", "t", "_", "m", "u", "t",
     "t", "o", "n", "_", "p", "i", "e", "c", "e", "s", "_", "t", "o", "_", "b", "e", "_", "l", "a", "d", "l", "e", "d",
     "_", "o", "u", "t", "_", "i", "n", "_", "t", "h", "i", "c", "k", "_", "p", "e", "p", "p", "e", "r", "e", "d", "_",
     "f", "l", "o", "u", "r", "_", "f", "a", "t", "t", "e", "n", "e", "d", "_", "s", "a", "u", "c", "e"],
    ["s", "t", "u", "f", "f", "_", "i", "t", "_", "i", "n", "t", "o", "_", "y", "o", "u", "_", "h", "i", "s", "_", "b",
     "e", "l", "l", "y", "_", "c", "o", "u", "n", "s", "e", "l", "l", "e", "d", "_", "h", "i", "m"],
    ["a", "f", "t", "e", "r", "_", "e", "a", "r", "l", "y", "_", "n", "i", "g", "h", "t", "f", "a", "l", "l", "_", "t",
     "h", "e", "_", "y", "e", "l", "l", "o", "w", "_", "l", "a", "m", "p", "s", "_", "w", "o", "u", "l", "d", "_", "l",
     "i", "g", "h", "t", "_", "u", "p", "_", "h", "e", "r", "e", "_", "a", "n", "d", "_", "t", "h", "e", "r", "e", "_",
     "t", "h", "e", "_", "s", "q", "u", "a", "l", "i", "d", "_", "q", "u", "a", "r", "t", "e", "r", "_", "o", "f", "_",
     "t", "h", "e", "_", "b", "r", "o", "t", "h", "e", "l", "s"],
    ["h", "e", "l", "l", "o", "_", "b", "e", "r", "t", "i", "e", "_", "a", "n", "y", "_", "g", "o", "o", "d", "_", "i",
     "n", "_", "y", "o", "u", "r", "_", "m", "i", "n", "d"],
    ["n", "u", "m", "b", "e", "r", "_", "t", "e", "n", "_", "f", "r", "e", "s", "h", "_", "n", "e", "l", "l", "y", "_",
     "i", "s", "_", "w", "a", "i", "t", "i", "n", "g", "_", "o", "n", "_", "y", "o", "u", "_", "g", "o", "o", "d", "_",
     "n", "i", "g", "h", "t", "_", "h", "u", "s", "b", "a", "n", "d"],
    ["t", "h", "e", "_", "m", "u", "s", "i", "c", "_", "c", "a", "m", "e", "_", "n", "e", "a", "r", "e", "r", "_", "a",
     "n", "d", "_", "h", "e", "_", "r", "e", "c", "a", "l", "l", "e", "d", "_", "t", "h", "e", "_", "w", "o", "r", "d",
     "s", "_", "t", "h", "e", "_", "w", "o", "r", "d", "s", "_", "o", "f", "_", "s", "h", "e", "l", "l", "e", "y", "'",
     "s", "_", "f", "r", "a", "g", "m", "e", "n", "t", "_", "u", "p", "o", "n", "_", "t", "h", "e", "_", "m", "o", "o",
     "n", "_", "w", "a", "n", "d", "e", "r", "i", "n", "g", "_", "c", "o", "m", "p", "a", "n", "i", "o", "n", "l", "e",
     "s", "s", "_", "p", "a", "l", "e", "_", "f", "o", "r", "_", "w", "e", "a", "r", "i", "n", "e", "s", "s"],
    ["t", "h", "e", "_", "d", "u", "l", "l", "_", "l", "i", "g", "h", "t", "_", "f", "e", "l", "l", "_", "m", "o", "r",
     "e", "_", "f", "a", "i", "n", "t", "l", "y", "_", "u", "p", "o", "n", "_", "t", "h", "e", "_", "p", "a", "g", "e",
     "_", "w", "h", "e", "r", "e", "o", "n", "_", "a", "n", "o", "t", "h", "e", "r", "_", "e", "q", "u", "a", "t", "i",
     "o", "n", "_", "b", "e", "g", "a", "n", "_", "t", "o", "_", "u", "n", "f", "o", "l", "d", "_", "i", "t", "s", "e",
     "l", "f", "_", "s", "l", "o", "w", "l", "y", "_", "a", "n", "d", "_", "t", "o", "_", "s", "p", "r", "e", "a", "d",
     "_", "a", "b", "r", "o", "a", "d", "_", "i", "t", "s", "_", "w", "i", "d", "e", "n", "i", "n", "g", "_", "t", "a",
     "i", "l"],
    ["a", "_", "c", "o", "l", "d", "_", "l", "u", "c", "i", "d", "_", "i", "n", "d", "i", "f", "f", "e", "r", "e", "n",
     "c", "e", "_", "r", "e", "i", "g", "n", "e", "d", "_", "i", "n", "_", "h", "i", "s", "_", "s", "o", "u", "l"],
    ["t", "h", "e", "_", "c", "h", "a", "o", "s", "_", "i", "n", "_", "w", "h", "i", "c", "h", "_", "h", "i", "s", "_",
     "a", "r", "d", "o", "u", "r", "_", "e", "x", "t", "i", "n", "g", "u", "i", "s", "h", "e", "d", "_", "i", "t", "s",
     "e", "l", "f", "_", "w", "a", "s", "_", "a", "_", "c", "o", "l", "d", "_", "i", "n", "d", "i", "f", "f", "e", "r",
     "e", "n", "t", "_", "k", "n", "o", "w", "l", "e", "d", "g", "e", "_", "o", "f", "_", "h", "i", "m", "s", "e", "l",
     "f"],
    ["a", "t", "_", "m", "o", "s", "t", "_", "b", "y", "_", "a", "n", "_", "a", "l", "m", "s", "_", "g", "i", "v", "e",
     "n", "_", "t", "o", "_", "a", "_", "b", "e", "g", "g", "a", "r", "_", "w", "h", "o", "s", "e", "_", "b", "l", "e",
     "s", "s", "i", "n", "g", "_", "h", "e", "_", "f", "l", "e", "d", "_", "f", "r", "o", "m", "_", "h", "e", "_", "m",
     "i", "g", "h", "t", "_", "h", "o", "p", "e", "_", "w", "e", "a", "r", "i", "l", "y", "_", "t", "o", "_", "w", "i",
     "n", "_", "f", "o", "r", "_", "h", "i", "m", "s", "e", "l", "f", "_", "s", "o", "m", "e", "_", "m", "e", "a", "s",
     "u", "r", "e", "_", "o", "f", "_", "a", "c", "t", "u", "a", "l", "_", "g", "r", "a", "c", "e"],
    ["w", "e", "l", "l", "_", "n", "o", "w", "_", "e", "n", "n", "i", "s", "_", "i", "_", "d", "e", "c", "l", "a", "r",
     "e", "_", "y", "o", "u", "_", "h", "a", "v", "e", "_", "a", "_", "h", "e", "a", "d", "_", "a", "n", "d", "_", "s",
     "o", "_", "h", "a", "s", "_", "m", "y", "_", "s", "t", "i", "c", "k"],
    ["o", "n", "_", "s", "a", "t", "u", "r", "d", "a", "y", "_", "m", "o", "r", "n", "i", "n", "g", "s", "_", "w", "h",
     "e", "n", "_", "t", "h", "e", "_", "s", "o", "d", "a", "l", "i", "t", "y", "_", "m", "e", "t", "_", "i", "n", "_",
     "t", "h", "e", "_", "c", "h", "a", "p", "e", "l", "_", "t", "o", "_", "r", "e", "c", "i", "t", "e", "_", "t", "h",
     "e", "_", "l", "i", "t", "t", "l", "e", "_", "o", "f", "f", "i", "c", "e", "_", "h", "i", "s", "_", "p", "l", "a",
     "c", "e", "_", "w", "a", "s", "_", "a", "_", "c", "u", "s", "h", "i", "o", "n", "e", "d", "_", "k", "n", "e", "e",
     "l", "i", "n", "g", "_", "d", "e", "s", "k", "_", "a", "t", "_", "t", "h", "e", "_", "r", "i", "g", "h", "t", "_",
     "o", "f", "_", "t", "h", "e", "_", "a", "l", "t", "a", "r", "_", "f", "r", "o", "m", "_", "w", "h", "i", "c", "h",
     "_", "h", "e", "_", "l", "e", "d", "_", "h", "i", "s", "_", "w", "i", "n", "g", "_", "o", "f", "_", "b", "o", "y",
     "s", "_", "t", "h", "r", "o", "u", "g", "h", "_", "t", "h", "e", "_", "r", "e", "s", "p", "o", "n", "s", "e", "s"],
    ["h", "e", "r", "_", "e", "y", "e", "s", "_", "s", "e", "e", "m", "e", "d", "_", "t", "o", "_", "r", "e", "g", "a",
     "r", "d", "_", "h", "i", "m", "_", "w", "i", "t", "h", "_", "m", "i", "l", "d", "_", "p", "i", "t", "y", "_", "h",
     "e", "r", "_", "h", "o", "l", "i", "n", "e", "s", "s", "_", "a", "_", "s", "t", "r", "a", "n", "g", "e", "_", "l",
     "i", "g", "h", "t", "_", "g", "l", "o", "w", "i", "n", "g", "_", "f", "a", "i", "n", "t", "l", "y", "_", "u", "p",
     "o", "n", "_", "h", "e", "r", "_", "f", "r", "a", "i", "l", "_", "f", "l", "e", "s", "h", "_", "d", "i", "d", "_",
     "n", "o", "t", "_", "h", "u", "m", "i", "l", "i", "a", "t", "e", "_", "t", "h", "e", "_", "s", "i", "n", "n", "e",
     "r", "_", "w", "h", "o", "_", "a", "p", "p", "r", "o", "a", "c", "h", "e", "d", "_", "h", "e", "r"],
    ["i", "f", "_", "e", "v", "e", "r", "_", "h", "e", "_", "w", "a", "s", "_", "i", "m", "p", "e", "l", "l", "e", "d",
     "_", "t", "o", "_", "c", "a", "s", "t", "_", "s", "i", "n", "_", "f", "r", "o", "m", "_", "h", "i", "m", "_", "a",
     "n", "d", "_", "t", "o", "_", "r", "e", "p", "e", "n", "t", "_", "t", "h", "e", "_", "i", "m", "p", "u", "l", "s",
     "e", "_", "t", "h", "a", "t", "_", "m", "o", "v", "e", "d", "_", "h", "i", "m", "_", "w", "a", "s", "_", "t", "h",
     "e", "_", "w", "i", "s", "h", "_", "t", "o", "_", "b", "e", "_", "h", "e", "r", "_", "k", "n", "i", "g", "h", "t"],
    ["h", "e", "_", "t", "r", "i", "e", "d", "_", "t", "o", "_", "t", "h", "i", "n", "k", "_", "h", "o", "w", "_", "i",
     "t", "_", "c", "o", "u", "l", "d", "_", "b", "e"]]


def wer(reference, hypothesis, ignore_case=False, delimiter="_"):
    if ignore_case == True:
        reference = reference.lower()
        hypothesis = hypothesis.lower()

    ref_words = reference.split(delimiter)
    hyp_words = hypothesis.split(delimiter)
    edit_distance = levenshteinDistance(ref_words, hyp_words)
    ref_len = len(ref_words)

    if ref_len > 0:
        wer = float(edit_distance) / ref_len
    else:
        raise ValueError("empty reference string")
    return wer


def cer(reference, hypothesis, ignore_case=False, remove_space=False):
    if ignore_case == True:
        reference = reference.lower()
        hypothesis = hypothesis.lower()

    join_char = " "
    if remove_space == True:
        join_char = ""

    reference = join_char.join(filter(None, reference.split(" ")))
    hypothesis = join_char.join(filter(None, hypothesis.split(" ")))

    edit_distance = levenshteinDistance(reference, hypothesis)
    ref_len = len(reference)
    if ref_len > 0:
        cer = float(edit_distance) / ref_len
    else:
        raise ValueError("empty reference string")
    return cer


def levenshteinDistance(ref, hyp):
    """
    calculate levenshtein distance (edit distance) between two sequences
    arguments:
        ref: reference sequence
        hyp: sequence to compare against the reference
    output:
        edit distance (int)
    """
    # Initialize a matrix matrix with dimensions (len(sequence1) + 1) × (len(sequence2) + 1)
    mat = np.zeros((len(ref) + 1, len(hyp) + 1), dtype=int)

    # Fill the first row of matrix with values ranging from 0 to len(sequence2)
    mat[0, :] = np.arange(len(hyp) + 1)

    # Fill the first column of matrix with values ranging from 0 to len(sequence1)
    mat[:, 0] = np.arange(len(ref) + 1)

    for i in range(1, len(ref) + 1):
        for j in range(1, len(hyp) + 1):
            # If the characters are the same, no cost is incurred
            if ref[i - 1] == hyp[j - 1]:
                mat[i, j] = mat[i - 1, j - 1]
            else:
                # If the characters are different, calculate the cost of insertion, deletion, and substitution
                insertion = mat[i, j - 1] + 1
                deletion = mat[i - 1, j] + 1
                substitution = mat[i - 1, j - 1] + 1

                # Take the minimum of the three costs
                mat[i, j] = min(insertion, deletion, substitution)
    # The edit distance is the value in the bottom-right corner of the matrix
    return mat[len(ref), len(hyp)]



for i in range(len(decoded_preds)):
    c = cer("".join(decoded_targets[i]), "".join(decoded_preds[i]))
    print(f"CER: {c}")
    w = wer("".join(decoded_targets[i]), "".join(decoded_preds[i]))
    print(f"WER: {w}")
    print()
